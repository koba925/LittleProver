# 定理証明手習い (26) 

「7. びっくりスター!」はスター型関数に関する定理の証明
題材はこれ

```
(defun ctx? (x)
  (if (atom x)
      (equal x '?)
      (if (ctx? (car x))
          't
          (ctx? (cdr x)))))
```

種は`(size x)`

証明すべき式はこれ

```
(if (natp (size x))
  (if (atom x)
      't
      (if (< (size (car x)) (size x))
          (if (ctx? (car x))
              't
              (< (size (cdr x)) (size x)))
          'nil))
  'nil)
```

> この関数が全域であるという主張は、本書の中でも特に複雑なものです。

そうですか
でも証明は特に難しくはありません

> 全域製の主張をどうやって構成するのかは、第８章で詳しく説明します。

おおざっぱに考えると
`(if (natp (size x)) ... 'nil)`はオマジナイで
あとは関数の形をもとにしつつ
`(car x)`や`(cdr x)`を見かけたら`size`が小さくなっていくことを
確かめるんだな
`(equal x '?)`は全域だってわかってるから`'t`に変換するって
ことだろうな
でも全域だからって`(atom x)`を`'t`に置き換えちゃうとこれは変
明確なルールにするとすればどうなるのかな
Q部はそのままとか？
もうちょっと何かありそうだ

しかしそろそろこれは人間には読めなくなってきてるのでは
ソフトウェア工学的にはこれは分割しなきゃおかしいんじゃないの
ifの持ち上げはこの前定理にしそこねたけど
あとわかりやすいところだと
全域製の証明で毎回出てくる`(if (natp (size x)) ... 'nil)`ってやつ
`(equal (if (natp (size x)) y 'nil) y)`を定理にしてしまえばいいんじゃない？
そこまであからさまじゃなくても定理にできるパターンってあるんじゃないかなあ

これは以前行きづまった
`(if (equal x '()) 't 'nil)`を`(equal x '())`に変形する
に似てるのでは？